function loadExploreYourAreaGroups(){console.log("Loading explore your area with counts...");$.mobile.loadingMessage="Loading groups....";$.mobile.showPageLoadingMsg();$(".ui-loader").css({display:"block"});var a=currentLatitude+"|"+currentLongitude+"|"+getCurrentRadius();if(a!=currentLatLongRadius){currentLatLongRadius=a;console.log("Retrieve species group counts");$("#speciesGroupsList").empty();var b="https://m.ala.org.au/exploreGroups?lat="+currentLatitude+"&lon="+currentLongitude+"&radius="+getCurrentRadius();$.getJSON(b,function(a){var b=true;for(var c=0;c<a.length;c++){console.log(a[c].name+" : "+a[c].speciesCount);if(a[c].speciesCount>0&&a[c].name!="Arthropods"&&a[c].name!="Animals"&&a[c].name!="ALL_SPECIES"&&a[c].name!="Chromista"&&a[c].name!="Protozoa"&&a[c].name!="Bacteria"){var d="\"javascript:exploreGroup('"+a[c].name+"');\"";$("#speciesGroupsList").append("<li><a href="+d+"><img src='images/"+a[c].name+".jpg'/><h3>"+a[c].name+'</h3><span class="ui-li-count">'+a[c].speciesCount+'</span><p><span class="currentLocation"></span></p></a></li>');b=false}}if(b){$("#speciesGroupsList").append('<li>No taxa found for <span class="currentLocation"></span>. Please refine your area by zooming out to increase the search radius, or search for another location.</li>')}$(".currentLocation").each(function(){var a=$("#locality").val();if(a==null||a==""){a=currentLatitude+"°, "+currentLongitude+"°"}if(circle.getRadius()>1e3){$(this).html(circle.getRadius()/1e3+" km around "+a)}else{$(this).html(circle.getRadius()+" metres around "+a)}});$("#speciesGroupsList").listview("refresh");$.mobile.hidePageLoadingMsg();$(".ui-loader").css({display:"none"});console.log("Finished - Retrieve species group counts")}).error(function(){$.mobile.hidePageLoadingMsg();alert("There was a problem loading these groups. Please try again.")})}else{$.mobile.hidePageLoadingMsg();$(".ui-loader").css({display:"none"});console.log("Lat/Long/Radius unchanged - avoiding WS call....")}}function authenticate(a,b){console.log("Authenticating with userName: "+a);var c=null;$.ajax({type:"POST",url:"https://m.ala.org.au/mobileauth/mobileKey/generateKey",data:{userName:a,password:b},async:false,success:function(d,e){c=d.authKey;try{localStorage.setItem("ala-userName",a);localStorage.setItem("ala-password",b);localStorage.setItem("ala-authKey",d.authKey);console.log("Authentication success. Using key: "+localStorage.getItem("ala-authKey"))}catch(f){console.log("Problem storing auth details - privat browsing may be in use")}},error:function(a,b,d){localStorage.setItem("ala-authKey","");c=null;console.log("Authentication failed: "+d)}});return c}function checkAuthentication(a,b){console.log("Authenticating with userName: "+a);var c=false;$.ajax({type:"POST",url:"https://m.ala.org.au/mobileauth/mobileKey/checkKey",data:{userName:a,authKey:b},async:false,success:function(a,d){console.log("Check key success. Using key: "+b);c=true},error:function(a,b,d){c=false;console.log("Check key failed: "+d)}});return c}function updateAuthSettings(){$("#detailsUserName").val(localStorage.getItem("ala-userName"));$("#detailsPassword").val(localStorage.getItem("ala-password"));var a=localStorage.getItem("ala-authKey");if(a!=null&&a!=""){$(".loginStatus").val("Logged in").css({color:"blue"});$("#yourDetailsLogin").attr("href","javascript:logout();");$("#yourDetailsLogin  .ui-btn-text").text("Logout")}else{$(".loginStatus").val("Not Logged in.");$("#yourDetailsLogin").attr("href","javascript:loginWithDetails();");$("#yourDetailsLogin  .ui-btn-text").text("Login")}}function authenticateFromDialogAndRecord(){var a=$("#authRecordDialogUserName").val();var b=$("#authRecordDialogPassword").val();var c=authenticate(a,b);if(c!=null){$("#authRecordDialogStatus").html("You are logged in....sending record...");$("#authRecordDialogStatus").css({color:"blue"});$("#authenticateAndRecord").dialog("close");postRecord(a,c)}else{$("#authRecordDialogStatus").html("Login failed").css({color:"red"})}}function loginWithDetails(){var a=$("#detailsUserName").val();var b=$("#detailsPassword").val();localStorage.setItem("ala-userName",a);localStorage.setItem("ala-password",b);localStorage.setItem("ala-authKey","");authenticate(a,b);var c=localStorage.getItem("ala-authKey");if(c!=null){localStorage.setItem("ala-authKey",c);$(".loginStatus").val("You are logged in.").css({color:"blue"});$("#yourDetailsLogin").attr("href","javascript:logout();");$("#yourDetailsLogin  .ui-btn-text").text("Logout")}else{$(".loginStatus").val("Login failed").css({color:"red"})}updateAuthSettings()}function logout(){$(".loginStatus").val("Not Logged in.");localStorage.setItem("ala-authKey","");$("#yourDetailsLogin").attr("href","javascript:loginWithDetails();");$("#yourDetailsLogin  .ui-btn-text").text("Login")}function toggleBounce(){if(marker.getAnimation()!=null){marker.setAnimation(null)}else{marker.setAnimation(google.maps.Animation.BOUNCE)}}function openLocationForRecording(){usingExploreYourArea=false;removeOverlayMarker();$("#nextActionFromLocation").attr("href","#details");$.mobile.changePage("#location")}function openLocationForExplore(){usingExploreYourArea=true;if(useLifeFormExplorer){$("#nextActionFromLocation").attr("href","#exploreYourArea")}else{$("#nextActionFromLocation").attr("href","javascript:startExploreByTaxonomy();")}if(map!=null){setOverlayMarker(false)}$.mobile.changePage("#location")}function authenticateOrSend(){var a=localStorage.getItem("ala-userName");var b=localStorage.getItem("ala-authKey");if(b!=null&&b!=""){var c=checkAuthentication(a,b);if(c){console.log("Authentication key is good....sending record now....");postRecord(a,b);console.log("Record sent!!!")}else{console.log("Authentication key is NOT good....user must re-authenticate....");$.mobile.changePage("#authenticateAndRecord")}}else{$.mobile.changePage("#authenticateAndRecord")}}function nativePostRecordWithImage(a,b){var c=function(a){$.mobile.hidePageLoadingMsg();console.log("Multipart message successfully sent!!");console.log("Code = "+a.responseCode);console.log("Response = "+a.response);console.log("Sent = "+a.bytesSent);recordSent=true;$("#postRecord .ui-btn-text").text("Record sent!")};var d=function(a){$.mobile.hidePageLoadingMsg();if(FileTransferError.FILE_NOT_FOUND_ERR==a.code){errmsg="Image not found"}else if(FileTransferError.INVALID_URL_ERR==a.code){errmsg="Invalid URL"}else if(FileTransferError.CONNECTION_ERR==a.code){errmsg="Connection error"}else{errmsg="Unknown error"}alert("An error has occurred: "+errmsg+"\nPlease try again.")};$.mobile.loadingMessage="Sending record with images....";$.mobile.showPageLoadingMsg();console.log("Native post of record with image - using Phonegap API...");var e=$("#test_img").attr("src");var f=new FileUploadOptions;f.fileKey="attribute_file_1";f.fileName=e.substr(e.lastIndexOf("/")+1);f.mimeType="image/jpeg";f.chunkedMode=true;var g=getRecordData(a,b);f.params=g;var h=new FileTransfer;h.upload(e,"https://m.ala.org.au/submit/recordMultiPart",c,d,f)}function getRecordData(a,b){console.log("Constructing data object for POST...");var c=new Object;c.surveyId=1;c.kingdom=$("#kingdom").val();console.log("Kingdom: "+c.kingdom);c.family=$("#family").val();console.log("Family: "+c.family);c.taxonID=$("#taxonID").val();console.log("TaxonID: "+c.taxonID);c.scientificName=$("#scientificName").val();console.log("Scientific name: "+c.scientificName);c.survey_species_search=$("#scientificName").val();console.log("survey_species_search: "+c.survey_species_search);c.commonName=$("#commonName").val();console.log("common name: "+c.commonName);c.locationName=$("#locality").val();console.log("locationName: "+c.locationName);c.latitude=currentLatitude;console.log("latitude: "+c.latitude);c.longitude=currentLongitude;console.log("longitude: "+c.longitude);c.deviceName=device.name;console.log("device name: "+c.deviceName);c.deviceId=device.uuid;c.devicePlatform=device.platform;c.deviceVersion=device.version;c.user=a.toLowerCase();c.userName=a.toLowerCase();console.log("user: "+c.user);c.authenticationKey=b;console.log("auth key: "+c.authenticationKey);c.date=$("#occurrenceDate").val();c.time="12:00";c.notes=$("#notes").val();console.log("notes: "+c.notes);c.attribute_1="";c.number=$("#individualCount").val();c.coordinatePrecision=1;c.accuracyInMeters=100;return c}function webPostRecordWithImage(a,b){console.log("Doing a web post WITH IMAGE of the record to the BDRS...");var c=$("#test_img").attr("src").replace(/^data:image\/(png|jpeg|jpg);base64,/,"");var d=getRecordData(a,b);d.imageBase64=c;d.imageFileName="testFileName.jpg";d.imageContentType="image/jpeg";console.log(c);$.ajax({type:"POST",url:"https://m.ala.org.au/submit/record",data:d,success:function(a){recordSent=true;$("#postRecord .ui-btn-text").text("Record sent!");console.log("Record sent - success !")},error:function(a,b,c){console.log("There was a problem sending the record...."+c);console.log("Error description...."+b);alert("Record submission has failed...."+b)}})}function webPostRecord(a,b){console.log("Doing a web post of the record WITHOUT IMAGE to the BDRS...");$.mobile.loadingMessage="Sending record ...";$.mobile.showPageLoadingMsg();$.post("https://m.ala.org.au/submit/record",getRecordData(a,b),function(a){recordSent=true;$("#postRecord .ui-btn-text").text("Record sent!");console.log("Record sent - success !");$.mobile.hidePageLoadingMsg()}).error(function(){$.mobile.hidePageLoadingMsg();alert("There was a problem sending your record. Please try again.")})}function postRecord(a,b){if(recordSent){alert("Thanks. Record has already been submitted.");return}$("#postRecord .ui-btn-text").text("Sending record...");var c=$("#test_img").attr("src");if(isNative){if(c!=null&&c!=""){nativePostRecordWithImage(a,b)}else{webPostRecord(a,b)}}else{if(c!=null&&c!=""){webPostRecordWithImage(a,b)}else{webPostRecord(a,b)}}}function postRecord(){var a=localStorage.getItem("ala-userName");console.log("Localstorage retrieved user name: "+a);var b=localStorage.getItem("ala-authKey");postRecord(a,b)}function displayImageFromFS(a){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var b=a.target.files;for(var c=0,d;d=b[c];c++){alert("f.name: "+d.name)}}else{alert("The File APIs are not fully supported in this browser.")}}function removeCurrentImage(){document.getElementById("test_img").src="";$("#test_img").css("display","none")}function displayImageForUser(a){document.getElementById("test_img").src=a.file.src;$("#test_img_hidden").val(a.file.src);$("#test_img").css("display","block")}function handleImageSelect(a){var b=a.target.files;if(b.length>0){var c=b[0];var d=/image.*/;if(!c.type.match(d)){alert("Only images supported")}else{var e=new FileReader;e.onerror=function(a){alert("Error code: "+a.target.error.code)};e.onload=function(a){return function(b){var c={file:{name:a.name,src:b.target.result,fileSize:a.fileSize,type:a.type}};displayImageForUser(c)}}(c);e.readAsDataURL(c)}}}function getPictureFromFS(){$("#photofs").trigger("click")}function getPicture_Success(a){document.getElementById("test_img").src=a;$("#test_img").css("display","block")}function getPicture_Fail(a){alert("There was a problem getting the image:\n"+a)}function getPicture(a){var b={quality:50};if(a!=undefined){b["sourceType"]=a}b["destinationType"]=Camera.DestinationType.FILE_URI;navigator.camera.getPicture(getPicture_Success,getPicture_Fail,b)}function PictureSourceType(){}function setLocality(a,b){$.getJSON("https://m.ala.org.au/geocode?latlng="+a+","+b,function(a){$("#locality").val(a.results[0].formatted_address)})}function setMarkerToCurrentLocation(){if(navigator.geolocation){$.mobile.loadingMessage="Retrieving your location...";$.mobile.showPageLoadingMsg();navigator.geolocation.getCurrentPosition(function(a){var b=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);map.setCenter(b);marker.setPosition(b);map.setZoom(14);$("#latitude").val(a.coords.latitude);$("#longitude").val(a.coords.longitude);$("#latitudeDisplay").html(a.coords.latitude);$("#longitudeDisplay").html(a.coords.longitude);currentLatitude=a.coords.latitude;currentLongitude=a.coords.longitude;setLocality(a.coords.latitude,a.coords.longitude);if(usingExploreYourArea){setOverlayMarker(true)}});$.mobile.hidePageLoadingMsg()}else{$.mobile.hidePageLoadingMsg();alert("I'm sorry, but geolocation services are not supported by your browser.")}}function setOverlayMarker(a){if(circle!=null){circle.setMap(null)}circle=new google.maps.Circle({map:map,radius:getRadiusForCurrentZoom(),strokeWeight:1,strokeColor:"white",strokeOpacity:.5,fillColor:"#222",fillOpacity:.2,zIndex:-10});circle.bindTo("center",marker,"position");if(a){map.fitBounds(circle.getBounds())}}function removeOverlayMarker(){if(circle!=null&&map!=null){circle.setMap(null)}}function getRadiusForCurrentZoom(){var a=map.getZoom();if(a>19)return 10;if(a==19)return 25;if(a==18)return 50;if(a==17)return 100;if(a==16)return 250;if(a==15)return 500;if(a==14)return 1e3;if(a==13)return 2e3;if(a==12)return 4e3;if(a==11)return 7e3;if(a==10)return 15e3;if(a==9)return 25e3;if(a==8)return 5e4;if(a==7)return 8e4;if(a==6)return 15e4;if(a==5)return 3e5;if(a==4)return 5e5;return 8e5}function recordSighting(){recordSent=false;$("#postRecord").buttonMarkup({theme:"a"});$("#postRecord .ui-btn-text").text("Record your sighting");usingExploreYourArea=false;$("#nextActionFromLocation").attr("href","#details");if(circle!=null){circle.setMap(null)}if(typeof FileReader!=="undefined"){console.log("File reader is available for this browser....");$.mobile.changePage("#photoUpload")}else{console.log("File reader is NOT available for this browser. Sending to set Location...");$.mobile.changePage("#location")}}function setCurrentLocationToMarkerCoords(){console.log("Setting map to current location of user...");var a=marker.getPosition();map.setCenter(a);$("#latitude").val(a.lat());$("#longitude").val(a.lat());$("#latitudeDisplay").html(a.lat());$("#longitudeDisplay").html(a.lng());currentLatitude=a.lat();currentLongitude=a.lng();setLocality(a.lat(),a.lng())}function exploreGroupWithGalleryLoadMore(){currentGroupStartIndex=currentGroupStartIndex+exploreGroupWithGalleryPageSize;var a="https://m.ala.org.au/exploreGroup?group="+currentGroup+"&lat="+currentLatitude+"&lon="+currentLongitude+"&radius="+getCurrentRadius()+"&pageSize="+(exploreGroupWithGalleryPageSize+1)+"&start="+currentGroupStartIndex;$.getJSON(a,function(a){for(var b=0;b<a.length;b++){var c="https://m.ala.org.au/species/image/small/"+a[b].guid;var d="https://m.ala.org.au/species/image/thumbnail/"+a[b].guid;var e="";$("#exploreGroupWithGalleryList").append(renderImageLinkForBIE(c,d,a[b].name+": "+a[b].commonName))}var f=$(".gallery a").photoSwipe({enableMouseWheel:false,enableKeyboard:false})})}function exploreGroupWithGallery(){$("#loadMoreForCurrentGroupGallery").css({display:"none"});$.mobile.changePage("#exploreGroupWithGallery");exploreGroupWithGalleryStartIndex=0;$("#exploreGroupWithGalleryTitle").html(currentGroup+" gallery");$("#exploreGroupWithGalleryList").empty();var a="https://m.ala.org.au/exploreGroup?group="+currentGroup+"&lat="+currentLatitude+"&lon="+currentLongitude+"&radius="+getCurrentRadius()+"&pageSize="+(exploreGroupWithGalleryPageSize+1)+"&start="+currentGroupStartIndex;$.getJSON(a,function(a){for(var b=0;b<a.length;b++){var c="https://m.ala.org.au/species/image/large/"+a[b].guid;var d="https://m.ala.org.au/species/image/thumbnail/"+a[b].guid;var e="";$("#exploreGroupWithGalleryList").append(renderImageLinkForBIE(c,d,a[b].name+": "+a[b].commonName))}var f=$(".gallery a").photoSwipe({enableMouseWheel:false,enableKeyboard:false});if(a.length>groupPageSize){$("#loadMoreForCurrentGroupGallery").css({display:"block"})}else{$("#loadMoreForCurrentGroupGallery").css({display:"none"})}})}function latestImagesLoadMore(){$.mobile.loadingMessage="Loading more images...";$.mobile.showPageLoadingMsg();latestImagesStartIndex=latestImagesStartIndex+latestImagesPageSize;var a="https://m.ala.org.au/latestImages?pageSize="+latestImagesPageSize+"&start="+latestImagesStartIndex;$.getJSON(a,function(a){for(var b=0;b<a.occurrences.length;b++){var c=constructImageLabel(a.occurrences[b]);$("#latestImagesList").append(renderImageLink(a.occurrences[b].thumbnailUrl,a.occurrences[b].smallImageUrl,a.occurrences[b].largeImageUrl,c))}var d=$(".gallery a").photoSwipe({enableMouseWheel:false,enableKeyboard:false});$.mobile.hidePageLoadingMsg()})}function constructImageLabel(a){var b=a.scientificName;if(a.vernacularName!=="undefined"&&a.vernacularName!=null){b=b+": "+a.vernacularName}b=b+"\n\n http://biocache.ala.org.au/occurrences/"+a.uuid;return b}function latestImages(){$("#latestImagesLoadMore").css("display","none");$.mobile.loadingMessage="Checking for new images...";$.mobile.showPageLoadingMsg();$("#latestImagesList").empty();latestImagesStartIndex=0;var a="https://m.ala.org.au/latestImages?pageSize="+latestImagesPageSize;$.getJSON(a,function(a){for(var b=0;b<a.occurrences.length;b++){var c=constructImageLabel(a.occurrences[b]);$("#latestImagesList").append(renderImageLink(a.occurrences[b].thumbnailUrl,a.occurrences[b].smallImageUrl,a.occurrences[b].largeImageUrl,c))}var d=$(".gallery a").photoSwipe({enableMouseWheel:false,enableKeyboard:false});$.mobile.hidePageLoadingMsg();if(a.occurrences.length>0){$("#latestImagesLoadMore").css("display","block")}})}function renderImageLinkForBIE(a,b,c){var d='<a href="'+a+'" rel="external">';if(a!=null){d=d+"<img src='"+b+"'  alt='"+c+"' />"}d=d+"</a>";return"<li>"+d+"</li>"}function renderImageLink(a,b,c,d){var e='<a href="'+c+'" rel="external">';if(c!=null){if(useLargerImages){e=e+"<img src='"+b+"'  alt='"+d+"' />"}else{e=e+"<img src='"+a+"'  alt='"+d+"' />"}}e=e+"</a>";return"<li>"+e+"</li>"}function getCurrentRadius(){return parseFloat(circle.getRadius())/1e3}function loadSavedList(){$.mobile.loadingMessage="Retrieving saved list...";$.mobile.showPageLoadingMsg();$("#savedList").empty();var a=0;for(var b=0;b<localStorage.length;b++){var c=localStorage.key(b);if(c.substring(0,5)==="image"){a=a+1;var d=c.substring(5);var e=localStorage.getItem("name"+d);$("#savedList").append("<li><a href=\"javascript:loadSavedImage('"+c+"');\">"+e+"</a></li>")}}$("#savedList").listview("refresh");if($("#savedList").children().length>0){$("#noSavedListMessage").css({display:"none"})}else{$("#noSavedListMessage").css({display:"block"})}$.mobile.hidePageLoadingMsg()}function loadSavedImage(a){$("#savedImageView").empty();$("#savedImageView").append('<img style="width:100%;" alt="'+name+'" src="data:image/jpeg;base64,'+localStorage.getItem(a)+'"/>');$.mobile.changePage("#savedImageViewer")}function getBase64Image(a){var b=document.createElement("canvas");b.width=a.width;b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0);var d=b.toDataURL("image/png");var e=d.replace(/^data:image\/(png|jpg);base64,/,"");return e}function saveCurrentList(a){$.mobile.loadingMessage="Saving your list for offline viewing...";$.mobile.showPageLoadingMsg();$(".ui-loader").css({display:"block"});$("#savedList").empty();clearSavedList();$("#exploreGroupWithGalleryList img").each(function(a){console.log("saving image: "+this);var b=getBase64Image(this);localStorage.setItem("name"+a,$(this).attr("alt"));localStorage.setItem("image"+a,b)});$.mobile.hidePageLoadingMsg();$(".ui-loader").css({display:"none"})}function clearSavedList(){for(var a=0;a<localStorage.length;a++){var b=localStorage.key(a);if(b.substring(0,5)==="image"){localStorage.removeItem(b)}}}function loadMoreForCurrentGroup(){$.mobile.loadingMessage="Loading more...";$.mobile.showPageLoadingMsg();$(".ui-loader").css({display:"block"});var a=parseFloat(circle.getRadius())/1e3;currentGroupStartIndex=groupPageSize+currentGroupStartIndex;var b="https://m.ala.org.au/exploreGroup?group="+currentGroup+"&lat="+currentLatitude+"&lon="+currentLongitude+"&radius="+getCurrentRadius()+"&pageSize="+(exploreGroupWithGalleryPageSize+1)+"&start="+currentGroupStartIndex;$.getJSON(b,function(a){for(var b=0;b<a.length&&b<groupPageSize;b++){var c="https://m.ala.org.au/species/image/thumbnail/"+a[b].guid;$("#exploreList").append(renderSearchResult(a[b].guid,a[b].name,a[b].commonName,c,a[b].count));$("#exploreList").listview("refresh")}if(a.length<=groupPageSize){$("#loadMoreForCurrentGroup").css({display:"none"})}$.mobile.hidePageLoadingMsg();$(".ui-loader").css({display:"none"})})}function exploreGroup(a){$.mobile.loadingMessage="Loading group...";$.mobile.showPageLoadingMsg();$("#loadMoreForCurrentGroup").css({display:"none"});$(".ui-loader").css({display:"block"});currentGroup=a;$("#exploreList").empty();$("#exploreGroupTitle").html("Explore "+a);$.mobile.changePage("#exploreGroup");currentGroupStartIndex=0;var b=parseFloat(circle.getRadius())/1e3;var c="https://m.ala.org.au/exploreGroup?group="+currentGroup+"&lat="+currentLatitude+"&lon="+currentLongitude+"&radius="+getCurrentRadius()+"&pageSize="+(exploreGroupWithGalleryPageSize+1)+"&start="+currentGroupStartIndex;$.getJSON(c,function(a){for(var b=0;b<a.length&&b<groupPageSize;b++){var c="https://m.ala.org.au/species/image/thumbnail/"+a[b].guid;$("#exploreList").append(renderSearchResult(a[b].guid,a[b].name,a[b].commonName,c,a[b].count));$("#exploreList").listview("refresh")}if(a.length>groupPageSize){$("#loadMoreForCurrentGroup").css({display:"block"})}else{$("#loadMoreForCurrentGroup").css({display:"none"})}$.mobile.hidePageLoadingMsg();$(".ui-loader").css({display:"none"})})}function getPreviousRankXXXX(a){if(a=="phylum")return"";if(a=="class")return"kingdom";if(a=="order")return"phylum";if(a=="family")return"class";if(a=="names_and_lsid")return"order";return""}function getPreviousRank(a){if(a=="phylum")return"kingdom";if(a=="class")return"phylum";if(a=="order")return"class";if(a=="family")return"order";if(a=="names_and_lsid")return"family";return""}function getNextRank(a){if(a=="kingdom")return"phylum";if(a=="phylum")return"class";if(a=="class")return"order";if(a=="order")return"family";if(a=="family")return"names_and_lsid";return"kingdom"}function getPlural(a){if(a=="kingdom")return"Kingdoms";if(a=="phylum")return"Phyla";if(a=="class")return"Classes";if(a=="order")return"Orders";if(a=="family")return"Families";if(a=="names_and_lsid")return"Species & Subspecies";return"kingdoms"}function exploreByTaxonomy(a,b){$("#exploreByTaxonomyList").empty();console.log("Set the taxon name: "+a);if(a!=="undefined"&&a!=null){if(currentRank!=""){currentClassification[currentRank]=currentTaxonName;console.log("Storing classification "+currentRank+" : "+currentClassification[currentRank])}console.log("Setting the taxon name to...... "+a);currentRank=b;currentTaxonName=a}var c=getNextRank(currentRank);$.mobile.loadingMessage="Loading "+getPlural(c)+"...";$.mobile.showPageLoadingMsg();var d="https://m.ala.org.au/occurrenceSearch?lat="+currentLatitude+"&lon="+currentLongitude+"&radius="+getCurrentRadius()+"&facets="+c+"&pageSize=0&start=0";if(currentTaxonName!=""){d=d+"&q="+currentRank+":"+currentTaxonName}else{d=d+"&q=*:*"}console.log(d);$.getJSON(d,function(a){$("#exploreByTaxonomyList").append('<li data-role="list-divider">'+getPlural(c)+"</li>");for(var d=0;d<a.facetResults[0].fieldResult.length;d++){if(a.facetResults[0].fieldName!="names_and_lsid"){var e=a.facetResults[0].fieldResult[d].label;$("#exploreByTaxonomyList").append('<li id="'+e+'"><a href="javascript:exploreByTaxonomy(\''+e+"','"+c+"', this);\">"+e+"</a></li>")}else{var f=a.facetResults[0].fieldResult[d].label.split("|");var g="<a href=\"javascript:openSpeciesPage('"+f[1]+"')\">";if(showImagesInSearch){g=g+'<img src="https://m.ala.org.au/species/image/thumbnail/'+f[1]+'"/>'}if(f[2]==""){g=g+'<h4 class="searchResultHdr"><i>'+f[0]+"</i></h4>"}else{g=g+'<h4 class="searchResultHdr">'+f[2]+"</h4>";g=g+"<p><strong><i>"+f[0]+"</strong></i>"}g=g+'<p class="occurrenceCount">Recorded occurrences: '+a.facetResults[0].fieldResult[d].count+"</p>";g=g+"</a>";$("#exploreByTaxonomyList").append("<li>"+g+"</li>")}}if(getPreviousRank(currentRank)!=""){var h=getPreviousRank(currentRank);console.log("Current rank: "+b+", Current facets on: "+c+", previous rank: "+h);$("#backUpTheTree").attr("href","javascript:exploreByTaxonomy('"+currentClassification[h]+"','"+h+"');");$("#backUpTheTree .ui-btn-text").html("View "+getPlural(b)+" for "+currentClassification[h]);$("#backUpTheTree").css({display:"block"});$("#backUpTheTree").css({"margin-bottom":"35px"})}else{$("#backUpTheTree").attr("href","javascript:resetExploreByTaxonomy();exploreByTaxonomy();");$("#backUpTheTree").css({display:"block"});$("#backUpTheTree").css({"margin-bottom":"35px"});$("#backUpTheTree .ui-btn-text").html("View all kingdoms");$("#backUpTheTree").attr({"data-icon":""})}$("#exploreByTaxonomyList").listview("refresh");$.mobile.hidePageLoadingMsg()})}function resetExploreByTaxonomy(){currentRank="";currentTaxonName="";currentClassification=new Object}function startExploreByTaxonomy(){currentRank="";currentTaxonName="";currentClassification=new Object;$.mobile.changePage("#exploreByTaxonomy")}function renderSearchResult(a,b,c,d,e){var f="<a href=\"javascript:openSpeciesPage('"+a+"');\">";if(showImagesInSearch){if(d!=null){f=f+'<img src="'+d+'" />'}else{f=f+'<img src="images/noImage85.jpg" />'}}if(c==null||c==undefined||c==""){f=f+'<h4 class="searchResultHdr"><i>'+b+"</i></h4>"}else{f=f+'<h4 class="searchResultHdr">'+c+"</h4>";f=f+"<p><strong><i>"+b+"</i></strong></p>"}if(e!=="undefined"&&e!=null){f=f+"<p>Recorded occurrences: "+e+"</p>"}f=f+"</a>";return"<li>"+f+"</li>"}function addSynonyms(a,b){if(b.length>0){$("#synonyms").append("<h4>Other names</h4>");var c=$("<ul>").attr("id","synonymList").attr("class","namesList");$("#synonyms").append(c);for(var d=0;d<b.length;d++){$("#synonymList").append("<li>"+getSciNameHtml(a,b[d].nameString)+"</li>")}}}function addCommonNames(a){if(a.length>0){$("#commonNames").append("<h4>Common names</h4>");var b=$("<ul>").attr("id","commonNamesList").attr("class","namesList");$("#commonNames").append(b);$("#currentCommonName").val(a[0].nameString);for(var c=0;c<a.length&&c<1;c++){$("#commonNamesList").append("<li>"+a[c].nameString+"</li>")}}}function getImageHTML(a){var b='<img width="290px" src="'+a.repoLocation.replace("raw.","smallRaw.")+'"/>';if(a.creator!=="undefined"&&a.creator!=null){b=b+'<br/><span class="imageCreator">Creator: '+a.creator+"</span>"}if(a.rights!=="undefined"&&a.rights!=null){b=b+'<br/><span class="imageRights">Rights:'+a.rights+"</span>"}return b}function getImageAttributionHTML(a){var b='<span class="imageInfoSourceNameAttr">Source: ';b=b+'<a target="_blank" rel="external" href="';if(a.isPartOf!=="undefined"&&a.isPartOf!=null){b=b+a.isPartOf}else{b=b+a.infoSourceURL}b=b+'">';b=b+a.infoSourceName;b=b+"</a></span>";return b}function getUrlVars(){var a=[],b;var c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var d=0;d<c.length;d++){b=c[d].split("=");a.push(b[0]);a[b[0]]=b[1]}return a}function openSpeciesPage(a){$.mobile.loadingMessage="Loading species details...";$.mobile.showPageLoadingMsg();$(".ui-loader").css({display:"block"});$.mobile.changePage("#speciesPage");$("#taxonDetails").empty();$("#commonNames").empty();$("#synonyms").empty();$("#conservation").empty();$("#classification").empty();$("#simpleProperties").empty();$("#images").empty();$("#imageAttribution").empty();$("#occurrenceMap").empty();$("#nameSources").empty();var b="https://m.ala.org.au/species/"+a+".json";$.getJSON(b,function(a){if(a.commonNames.length>0){$("#mainTitle").html(a.commonNames[0].nameString);$("#commonName").val(a.commonNames[0].nameString)}else{$("#mainTitle").html(a.taxonConcept.nameString)}$("#currentGuid").val(a.taxonConcept.guid);$("#currentScientificName").val(a.taxonConcept.nameString);$("#guid").val(a.taxonConcept.guid);$("#taxonID").val(a.taxonConcept.guid);$("#scientificName").val(a.taxonConcept.nameString);if(a.classification!=null){$("#taxonDetails").append("<p>Scientific name: "+a.classification.scientificName+"</p>");$("#taxonDetails").append("<p>Family: "+a.classification.family+"</p>");$("#taxonDetails").append("<p>Kingdom: "+a.classification.kingdom+"</p>")}$("#family").val(a.classification.family);$("#kingdom").val(a.classification.kingdom);$("#classification").append("<h4>Classification</h4>");$("#classification").append('<ul id="classificationList">');$("#classificationList").append('<li id="#scientificNameDisplay">Scientific name: '+getSciNameHtml(a.taxonConcept.rankID,a.taxonConcept.nameString)+"</li>");$("#classificationList").append('<li id="#familyDisplay">Family: '+a.classification.family+"</li>");$("#classificationList").append('<li id="#kingdomDisplay">Kingdom: '+a.classification.kingdom+"</li>");addCommonNames(a.commonNames);addSynonyms(a.taxonConcept.rankID,a.synonyms);for(var b=0;b<a.conservationStatuses.length&&b<1;b++){var c=a.conservationStatuses[b];var d="";if(c.region!=null&&c.region!=""){d=c.region}else{d="IUCN"}if(c.status!=="undefined"&&c.status!=null){if(c.status.indexOf("Extinct")==0){$("#conservation").append('<div><span class="iucn red">'+getRegionCode(d)+"</span>"+c.status+"</div>")}if(c.status.indexOf("Extinct")==0){$("#conservation").append('<div><span class="iucn red">'+getRegionCode(d)+"</span>"+c.status+"</div>")}if(c.status.indexOf("wild")>0){$("#conservation").append('<div><span class="iucn red">'+getRegionCode(d)+"</span>"+c.status+"</div>")}if(c.status.indexOf("Critically")==0){$("#conservation").append('<div><span class="iucn red">'+getRegionCode(d)+"</span>"+c.status+"</div>")}if(c.status.indexOf("Endangered")==0){$("#conservation").append('<div><span class="iucn yellow">'+getRegionCode(d)+"</span>"+c.status+"</div>")}if(c.status.indexOf("Vulnerable")==0){$("#conservation").append('<div><span class="iucn yellow">'+getRegionCode(d)+"</span>"+c.status+"</div>")}if(c.status.indexOf("Near")==0){$("#conservation").append('<div><span class="iucn green">'+getRegionCode(d)+"</span>"+c.status+"</div>")}if(c.status.indexOf("concern")>0){$("#conservation").append('<div><span class="iucn green">'+getRegionCode(d)+"</span>"+c.status+"</div>")}}}var e="";var f="";var g="";var h="";for(var b=0;b<a.simpleProperties.length;b++){var i=null;if(a.simpleProperties[b].name=="http://ala.org.au/ontology/ALA#hasDescriptiveText"){i="Description";if(e.length>0){e=e+"<br/>"}e=e+a.simpleProperties[b].value}else if(a.simpleProperties[b].name=="http://ala.org.au/ontology/ALA#hasEcologicalText"){i="Ecology";if(g.length>0){g=g+"<br/>"}g=g+a.simpleProperties[b].value}else if(a.simpleProperties[b].name=="http://ala.org.au/ontology/ALA#hasMorphologicalText"){i="Morphology";if(h.length>0){h=h+"<br/>"}h=h+a.simpleProperties[b].value}else if(a.simpleProperties[b].name=="http://ala.org.au/ontology/ALA#hasDistributionText"){i="Distribution";if(f.length>0){f=f+"<br/>"}f=f+a.simpleProperties[b].value}}if(e.length>0){$("#simpleProperties").append("<h4>Description</h4>");$("#simpleProperties").append('<p id="description">'+e+"</p>")}var j=0;$("#images").append('<ul id="imageList">');$("#imageAttribution").append("<h4>Image sources</h4>");$("#imageAttribution").append('<ol id="imageAttributionList">');for(var b=0;b<a.images.length&&j<noOfImagesToShow;b++){if(!a.images[b].isBlackListed){$("#imageList").append("<li>"+getImageHTML(a.images[b])+"</li>");$("#imageAttributionList").append("<li>"+getImageAttributionHTML(a.images[b])+"</li>");j=j+1}}$("#occurrenceMap").append("<h4>Occurrences map</h4>");$("#occurrenceMap").append('<img width="290px" src="http://m.ala.org.au/ws/density/map?q=lsid:'+a.taxonConcept.guid+'"/>');$("#nameSources").append("<h4>Taxonomic source</h4>");$("#nameSources").append('<ul id="taxonomicList">');var k="";var l="";if(a.taxonConcept.guid.indexOf("afd.taxon")>0){k="http://www.environment.gov.au/biodiversity/abrs/online-resources/fauna/afd/taxa/"+a.taxonConcept.nameString;l="Australian Faunal Directory"}else if(a.taxonConcept.guid.indexOf("apni.taxon")>0){k="http://biodiversity.org.au/name/"+a.taxonConcept.nameString+".html";l="Australian Plant Names Index"}if(k!=""){$("#taxonomicList").append('<li><a target="_blank" rel="external" href="'+k+'">'+l+"</a></li>")}$("#alaSpeciesPageLink").attr("href","http://bie.ala.org.au/species/"+a.taxonConcept.guid);$.mobile.hidePageLoadingMsg();$(".ui-loader").css({display:"none"})}).error(function(){$.mobile.hidePageLoadingMsg();$(".ui-loader").css({display:"none"});alert("There was a problem connecting to the server. Please try again.")})}function getSciNameHtml(a,b){if(a>6e3){return"<i>"+b+"</i>"}else{return b}}function getRegionCode(a){if(a=="South Australia")return"SA";if(a=="New South Wales")return"NSW";if(a=="Victoria")return"VIC";if(a=="Tasmania")return"TAS";if(a=="Northern Territory")return"NT";if(a=="Queensland")return"QLD";if(a=="Western Australia")return"WA";if(a=="Australia")return"AUS";return a}function search(){$.mobile.loadingMessage="Searching...";$.mobile.showPageLoadingMsg();$("#searchResults").empty();var a="https://m.ala.org.au/search.json?fq=idxtype:TAXON&fq=hasImage:true&pageSize=30&q=";a=a+$("#initialSearch").val();$.getJSON(a,function(a){for(var b=0;b<a.searchResults.results.length;b++){var c=null;if(a.searchResults.results[b].thumbnail!=null){c=a.searchResults.results[b].thumbnail.replace("/data/bie/","https://m.ala.org.au/repo/")}var d=renderSearchResult(a.searchResults.results[b].guid,a.searchResults.results[b].name,a.searchResults.results[b].commonNameSingle,c);$("#searchResults").append(d)}if(a.searchResults.results.length==0){$("#searchResults").append("<li> No taxa found </li>")}$("#searchResults").listview("refresh");$.mobile.hidePageLoadingMsg()}).error(function(){$.mobile.hidePageLoadingMsg();alert("There was a problem connecting to the server. Please try again.")})}function searchForPlace(){$.mobile.loadingMessage="Searching....";$.mobile.showPageLoadingMsg();var a="https://m.ala.org.au/placeSearch?address=";a=a+$("#placeSearch").val()+", Australia";$.getJSON(a,function(a){if(a.results.length>0){var b=a.results[0].geometry.location.lat;var c=a.results[0].geometry.location.lng;var d=new google.maps.LatLng(b,c);map.setCenter(d);$("#latitude").val(b);$("#longitude").val(c);$("#latitudeDisplay").html(b);$("#longitudeDisplay").html(c);currentLatitude=b;currentLongitude=c;marker.setPosition(d);var e=a.results[0].geometry.viewport;map.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(e.southwest.lat,e.southwest.lng),new google.maps.LatLng(e.northeast.lat,e.northeast.lng)));if(usingExploreYourArea){setOverlayMarker(true)}$("#locality").val(a.results[0].formatted_address);$.mobile.hidePageLoadingMsg()}else{$.mobile.hidePageLoadingMsg();alert('Unable to locate "'+$("#placeSearch").val()+'". Please try another search.')}}).error(function(){$.mobile.hidePageLoadingMsg();alert("There was a problem connecting to the server. Please try again.")})}function initializeMap(){var a=document.getElementById("map_canvas");console.log("detected window height: "+$(window).height());if($(window).height()!=="undefined"&&$(window).height()!=null){console.log("window size: "+$(window).height());if($(window).height()>400){a.style.width=$(window).width()-20+"px";a.style.height=$(window).height()-160+"px";$(window).resize(function(){a.style.width=$(window).width()-20+"px";a.style.height=$(window).height()-160+"px"})}else{a.style.width="304px";a.style.height="260px"}}else{a.style.width="304px";a.style.height="270px"}var b={zoom:defaultZoom,center:new google.maps.LatLng(currentLatitude,currentLongitude),mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},mapTypeControl:true};map=new google.maps.Map(document.getElementById("map_canvas"),b);var c=new google.maps.LatLng(currentLatitude,currentLongitude);marker=new google.maps.Marker({map:map,draggable:true,animation:google.maps.Animation.DROP,position:c,title:"Marker Location"});google.maps.event.addListener(marker,"dragend",function(){setCurrentLocationToMarkerCoords()});google.maps.event.addListener(map,"zoom_changed",function(){if(usingExploreYourArea){setOverlayMarker(false)}});if(usingExploreYourArea){setOverlayMarker(false)}mapInitialised=true}var currentClassification=new Object;var currentTaxonName="";var currentRank="";var latestImagesStartIndex=0;var latestImagesPageSize=50;var exploreGroupWithGalleryStartIndex=0;var exploreGroupWithGalleryPageSize=50;PictureSourceType.PHOTO_LIBRARY=0;PictureSourceType.CAMERA=1;